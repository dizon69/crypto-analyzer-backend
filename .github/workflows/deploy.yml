name: ğŸš€ Deploy FastAPI Backend to VPS (Hetzner)

on:
  push:
    branches:
      - main  # Ubah jika pakai branch lain

jobs:
  deploy:
    name: ğŸ” Deploy to Hetzner
    runs-on: ubuntu-latest

    steps:
    - name: ğŸ“¥ Checkout source code
      uses: actions/checkout@v3

    - name: ğŸ” SSH & Deploy to VPS
      uses: appleboy/ssh-action@v1.0.0
      with:
        host: ${{ secrets.SSH_HOST }}
        username: ${{ secrets.SSH_USERNAME }}
        key: ${{ secrets.SSH_KEY }}
        script: |
          echo "ğŸ“¦ Pulling latest code..."
          cd /root/backend
          git pull origin main

          echo "ğŸ Activating venv..."
          source venv/bin/activate

          echo "ğŸ“¦ Installing dependencies..."
          pip install -r requirements.txt

          echo "ğŸ” Restarting backend service..."
          sudo systemctl restart backend
